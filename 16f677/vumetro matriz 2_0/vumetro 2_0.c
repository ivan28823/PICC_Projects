#include <16f677.h>
#device adc=16

#FUSES NOWDT,INTRC_IO,NOMCLR,NOBROWNOUT,NOPUT,NOPROTECT,NOCPD,IESO,FCMEN
#use delay(clock=8M)

#BYTE TRISA=0x85
#BYTE TRISB=0x86
#BYTE TRISC=0x87
#BYTE PORTA=0x05
#BYTE PORTB=0x06
#BYTE PORTC=0x07
#bit cl=PORTB.6
#bit data=PORTB.7
//Prototipos de funciones
void anuncio(int letrero);
int comprobar_adc(long analog);
//Programa pricipal
void main()
{
   setup_oscillator(OSC_8MHZ);
   setup_adc_ports(sAN2 | VSS_VREF);
   setup_adc(ADC_CLOCK_INTERNAL);
   set_adc_channel(2);
   delay_us(15);
   Trisc=0;
   Portc=0;
   Trisb=0b00110000;
   Portb=0;
   Trisa=255; 
   anuncio(1);
   anuncio(2);
   for(int i=0;i<8;++i)
   {cl=1;cl=0;}
   while(true)
   {
      data=1;cl=1;data=0;cl=0;
      for(int j=0;j<8;++j)
      {
         Portc=comprobar_adc(read_adc());
         delay_us(1300);
         cl=1;cl=0;
      }  
   }
}
void anuncio(int letrero)
{
   const int letras[]={
   /* */ 0,0,0,//////////////////////////////////////////////////////////////////////3
   /* */ 0,0,0,//////////////////////////////////////////////////////////////////////3
   /* */ 0,0,0,//////////////////////////////////////////////////////////////////////3
   /*C*/ 126   ,  255   ,  195   ,  195   ,  195   ,  195   ,  231   ,  102   ,  0  ,
   /*E*/   255   ,   255   ,   219   ,   219   ,   219   ,   219   ,   195   ,   195   ,   0   ,
   /*C*/ 126   ,  255   ,  195   ,  195   ,  195   ,  195   ,  231   ,  102   ,  0  ,
   /*Y*/ 224   ,  112   ,  48 ,  63 ,  63 ,  48 ,  112   ,  224   ,  0  ,
   /*T*/ 192   ,  192   ,  192   ,  255   ,  255   ,  192   ,  192   ,  192   ,  0  ,
   /* */ 0,0,0,//////////////////////////////////////////////////////////////////////3
   /*3*/ 0  ,  66 ,  219   ,  219   ,  219   ,  219   ,  255   ,  102   ,  0  ,
   /* */ 0,0,0,//////////////////////////////////////////////////////////////////////3
   /*I*/ 195   ,  195   ,  195   ,  255   ,  255   ,  195   ,  195   ,  195   ,  0  ,
   /*P*/   255   ,   255   ,   204   ,   204   ,   204   ,   204   ,   252   ,   120   ,   0   ,
   /*N*/ 255   ,  255   ,  96 ,  48 ,  24 ,  12 ,  255   ,  255   ,  0  ,
   /* */ 0,0,0,//////////////////////////////////////////////////////////////////////3
   /*S*/   114   ,   251   ,   219   ,   219   ,   219   ,   219   ,   223   ,   78   ,   0   ,
   /*C*/ 126   ,  255   ,  195   ,  195   ,  195   ,  195   ,  231   ,  102   ,  0  ,
   /*E*/   255   ,   255   ,   219   ,   219   ,   219   ,   219   ,   195   ,   195   ,   0   ,
   /* */ 0,0,0,//////////////////////////////////////////////////////////////////////3
   /*6*/   126   ,   255   ,   219   ,   219   ,   219   ,   219   ,   219   ,   78   ,   0   ,
   /*I*/ 195   ,  195   ,  195   ,  255   ,  255   ,  195   ,  195   ,  195   ,  0  ,
   /*M*/ 255   ,  255   ,  96 ,  56 ,  56 ,  96 ,  255   ,  255   ,  0  ,
   /*3*/ 0  ,  66 ,  219   ,  219   ,  219   ,  219   ,  255   ,  102   ,  0  ,
   /* */ 0,0,0,//////////////////////////////////////////////////////////////////////3
   /*I*/ 195   ,  195   ,  195   ,  255   ,  255   ,  195   ,  195   ,  195   ,  0  ,
   /*V*/ 252   ,  254   ,  3  ,  3  ,  3  ,  3  ,  254   ,  252   ,  0  ,
   /*A*/   127   ,   255   ,   204   ,   204   ,   204   ,   204   ,   255   ,   127   ,   0   ,
   /*N*/ 255   ,  255   ,  96 ,  48 ,  24 ,  12 ,  255   ,  255   ,  0  ,
   /* */ 0,0,0,//////////////////////////////////////////////////////////////////////3
   /*M*/ 255   ,  255   ,  96 ,  56 ,  56 ,  96 ,  255   ,  255   ,  0  ,
   /*O*/ 126   ,  255   ,  195   ,  195   ,  195   ,  195   ,  255   ,  126   ,  0  ,
   /*R*/   255   ,   255   ,   216   ,   220   ,   222   ,   219   ,   249   ,   112   ,   0   ,
   /*E*/   255   ,   255   ,   219   ,   219   ,   219   ,   219   ,   195   ,   195   ,   0   ,
   /*N*/ 255   ,  255   ,  96 ,  48 ,  24 ,  12 ,  255   ,  255   ,  0  ,
   /*O*/ 126   ,  255   ,  195   ,  195   ,  195   ,  195   ,  255   ,  126   ,  0  ,   
   /* */ 0,0,0,//////////////////////////////////////////////////////////////////////3
   /* */ 0,0,0,//////////////////////////////////////////////////////////////////////3
   //Mensaje 1 de 0 a 266
   /* */ 0,0,0,//////////////////////////////////////////////////////////////////////3
   /* */ 0,0,0,//////////////////////////////////////////////////////////////////////3
   /*M*/ 255   ,  255   ,  96 ,  56 ,  56 ,  96 ,  255   ,  255   ,  0  ,
   /*O*/ 126   ,  255   ,  195   ,  195   ,  195   ,  195   ,  255   ,  126   ,  0  ,
   /*D*/ 255   ,  255   ,  129   ,  129   ,  129   ,  129   ,  255   ,  126   ,  0  ,
   /*O*/ 126   ,  255   ,  195   ,  195   ,  195   ,  195   ,  255   ,  126   ,  0  ,
   /* */ 0,0,0,//////////////////////////////////////////////////////////////////////3
   /*1*/ 3  ,  51 ,  99 ,  255   ,  127   ,  3  ,  3  ,  3  ,  0  ,
   //Mensaje 2 de 267 a 321
   };   
   long inicio,fin,fin_msj;
   if(letrero==1)
   {inicio=0;fin_msj=266;}
   else if(letrero==2)
   {inicio=267;fin_msj=321;}
   fin=inicio+8;
   for(int i=0;i<8;++i)
   {cl=1;cl=0;}
   do
   {
      for (int j = 0; j < 8; ++j)
      {
         data=1;cl=1;data=0;cl=0;
         for (long i = inicio; i < fin; ++i)
         {
            Portc=letras[i];
            delay_us(2500);
            cl=1;cl=0;
         }
      }
      inicio++;fin++;
   }while(fin<fin_msj);
}
int comprobar_adc(long analog)
{
   int valor=1;
   if(analog<=21845) valor=1;
   else if(analog<=24924) valor=3;
   else if(analog<=28167) valor=7;
   else if(analog<=31626) valor=15;
   else if(analog<=35381) valor=31;
   else if(analog<=39569) valor=63;
   else if(analog<=44450) valor=127;
   else if(analog>=50706) valor=255;
   return valor;
}
